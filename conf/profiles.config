// profiles for containers and modes: stub, devel, debug, large, small
// See README for examples.


profiles {

	// stub run with stub annotation files
    stub {
		includeConfig 'stub.config'
		process {
			resourceLimits = [
        		cpus: 1, 
        		memory: 4.GB
    		]
            beforeScript = 'echo $HOSTNAME'
            debug = true
			executor = "local"
        }
	}

	// devel local run with minimal resources
    devel {
        process {
			resourceLimits = [
        		cpus: 1, 
        		memory: 8.GB
    		]
			executor = "local"
		}
    }

	// conda profile
	conda {
		conda.enabled = true
        // use a single env for the whole pipeline
        process.conda = "${projectDir}/environment.yml"
	}

	// docker profile
    docker {
        docker.enabled = true
        // Avoid this error:
        // WARNING: Your kernel does not support swap limit capabilities or the cgroup is not mounted. Memory limited without swap.
        // Testing this in nf-core after discussion here https://github.com/nf-core/tools/pull/351
        // once this is established and works well, nextflow might implement this behavior as new default.
		docker.runOptions = '-u $(id -u):$(id -g) --platform=linux/amd64'
		
    }

	// singularity profile
	singularity {
		singularity.enabled = true
		singularity.envWhitelist = ['SINGULARITY_TMPDIR']
		singularity.runOptions = '-B $SINGULARITY_TMPDIR:/tmp'
        singularity.autoMounts = true
	}

    // HPC run with large input bam files
	slurm {
		process {
			executor = 'slurm'
			queue = 'cpuq'	
		}		
	}
}
